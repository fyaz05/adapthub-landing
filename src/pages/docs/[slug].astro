---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar";
import AnnouncementBar from "../../components/AnnouncementBar";
import Footer from "../../components/Footer.astro";
import BackgroundPulse from "../../components/BackgroundPulse";
import { DOC_SECTIONS } from "../../constants/docs-data";

export function getStaticPaths() {
  return DOC_SECTIONS.map((section) => ({
    params: { slug: section.slug },
    props: { section },
  }));
}

const { section } = Astro.props;
---

<Layout
  title={`${section.title} | AdaptHub Docs`}
  description={section.description}
  keywords={["adapthub documentation", "adapthub guide", section.title.toLowerCase(), "how to use adapthub"]}
>
  <AnnouncementBar client:load transition:persist />
  <Navbar client:load transition:persist />

  <main id="main-content" class="relative isolate pt-32 md:pt-40 pb-32 overflow-x-clip min-h-[100svh] bg-void selection:bg-brand-teal/30 selection:text-white scroll-smooth">

    <BackgroundPulse client:load />

    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full max-w-4xl h-[400px] bg-brand-teal/[0.04] blur-[100px] rounded-full pointer-events-none" aria-hidden="true"></div>

    <svg class="absolute inset-0 w-full h-full pointer-events-none z-[1] opacity-[0.03]" aria-hidden="true">
      <filter id="doc-grain">
        <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch" />
        <feColorMatrix type="saturate" values="0" />
      </filter>
      <rect width="100%" height="100%" filter="url(#doc-grain)" />
    </svg>

    <div class="container mx-auto px-4 sm:px-6 md:px-12 lg:px-24 relative z-10 max-w-[1800px] mt-12 md:mt-20">

      {/* Back */}
      <a
        href="/docs"
        class="inline-flex items-center gap-3 font-mono text-[10px] text-zinc-400 uppercase tracking-[0.25em] hover:text-brand-teal transition-colors duration-300 mb-16 group"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 transform group-hover:-translate-x-0.5 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 5 5 12 12 19"></polyline>
        </svg>
        System Documentation
      </a>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-y-16 lg:gap-x-12 xl:gap-x-16 items-start relative">

        {/* Guide Line */}
        <div class="hidden lg:block absolute top-0 bottom-0 left-[25%] w-px bg-white/[0.04]" aria-hidden="true"></div>

        {/* Sidebar */}
        <aside class="lg:col-span-3 relative">
          <div class="lg:sticky lg:top-32 max-h-[calc(100vh-8rem)] overflow-y-auto custom-scrollbar pr-4">
            <div class="mb-8">
              <span class="font-mono text-[10px] text-zinc-400 uppercase tracking-[0.2em]">[ Directory ]</span>
            </div>
            <nav class="flex flex-col gap-1 relative">
              <div class="absolute -left-4 sm:-left-6 top-0 bottom-0 w-px bg-white/10 hidden sm:block"></div>
              {DOC_SECTIONS.map((s) => (
                <a
                  href={`/docs/${s.slug}`}
                  class={`group flex items-baseline gap-4 py-2.5 outline-none focus-visible:text-brand-teal ${s.slug === section.slug ? "text-white" : ""}`}
                >
                  <span class={`font-mono text-[9px] uppercase tracking-[0.25em] shrink-0 transition-colors duration-300 ${s.slug === section.slug ? "text-brand-teal" : "text-zinc-500 group-hover:text-brand-teal"}`}>
                    {s.sysRef}
                  </span>
                  <span class={`font-sans text-sm md:text-base tracking-wide transition-colors duration-300 ${s.slug === section.slug ? "text-white" : "text-zinc-400 group-hover:text-white"}`}>
                    {s.title}
                  </span>
                </a>
              ))}
              <div class="my-4 w-full h-px bg-white/5"></div>
              <a
                href="/docs/troubleshooting"
                class="group flex items-baseline gap-4 py-2.5 outline-none focus-visible:text-brand-teal"
              >
                <span class="font-mono text-[9px] text-amber-500/70 group-hover:text-amber-400 uppercase tracking-[0.25em] shrink-0 transition-colors duration-300">LOG.ERR</span>
                <span class="font-sans text-sm md:text-base text-zinc-400 group-hover:text-white tracking-wide transition-colors duration-300">Troubleshooting</span>
              </a>
            </nav>
          </div>
        </aside>

        {/* Content */}
        <article class="lg:col-start-5 lg:col-span-8 xl:col-start-5 xl:col-span-7">

          {/* Header */}
          <header class="mb-12 md:mb-16">
            <div class="flex items-center gap-4 mb-6">
              <span class="font-mono text-[10px] text-brand-teal uppercase tracking-[0.25em] bg-brand-teal/5 border border-brand-teal/20 px-2 py-0.5">
                REF {section.sysRef}
              </span>
              <div class="h-px bg-white/10 flex-1"></div>
            </div>
            <h1 class="text-[2.5rem] sm:text-5xl md:text-6xl font-serif text-white tracking-tighter leading-none mb-6">
              {section.title}
            </h1>
            <p class="text-zinc-400 font-sans text-lg leading-[1.7] max-w-[60ch] tracking-wide border-l-2 border-brand-teal/40 pl-6">
              {section.description}
            </p>
          </header>

          {/* Divider */}
          <div class="flex items-center gap-4 mb-14">
            <div class="h-px bg-white/10 flex-1"></div>
            <span class="font-mono text-[9px] text-zinc-700 uppercase tracking-[0.25em]">[ SYS.DOC ]</span>
            <div class="h-px bg-white/10 flex-1"></div>
          </div>

          {/* Body */}
          <div class="space-y-14 md:space-y-18">
            {section.body.map((block) => (
              <section>
                {block.heading && (
                  <h2 class="text-2xl md:text-3xl font-serif text-white tracking-tight leading-snug mb-7 relative pl-6">
                    <span class="absolute left-0 top-[0.35em] w-2 h-2 bg-brand-teal/50" aria-hidden="true"></span>
                    {block.heading}
                  </h2>
                )}
                <div class="space-y-5 md:space-y-7">
                  {block.paragraphs.map((para) => (
                    <p
                      class="text-zinc-300 font-sans text-base md:text-[1.125rem] leading-[1.85] tracking-wide max-w-[65ch]"
                      set:html={para}
                    ></p>
                  ))}
                </div>
              </section>
            ))}
          </div>

          {/* Footer nav */}
          <div class="mt-20 pt-12 border-t border-white/10">
            <div class="flex items-center justify-between">
              {(() => {
                const idx = DOC_SECTIONS.findIndex(s => s.slug === section.slug);
                const prev = idx > 0 ? DOC_SECTIONS[idx - 1] : null;
                const next = idx < DOC_SECTIONS.length - 1 ? DOC_SECTIONS[idx + 1] : null;
                return (
                  <>
                    {prev ? (
                      <a href={`/docs/${prev.slug}`} class="group flex items-center gap-3 font-mono text-[10px] text-zinc-400 uppercase tracking-[0.2em] hover:text-brand-teal transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 transform group-hover:-translate-x-0.5 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 5 5 12 12 19"></polyline></svg>
                        <span>{prev.sysRef} {prev.title}</span>
                      </a>
                    ) : <span />}
                    {next ? (
                      <a href={`/docs/${next.slug}`} class="group flex items-center gap-3 font-mono text-[10px] text-zinc-400 uppercase tracking-[0.2em] hover:text-brand-teal transition-colors duration-300">
                        <span>{next.sysRef} {next.title}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 transform group-hover:translate-x-0.5 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                      </a>
                    ) : <span />}
                  </>
                );
              })()}
            </div>
          </div>

        </article>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  main :global(strong) {
    color: white;
    font-weight: 500;
    border-bottom: 1px solid rgba(13, 148, 136, 0.35);
    padding-bottom: 1px;
  }
  main :global(em) {
    color: rgba(161, 161, 170, 0.9);
    font-style: italic;
  }
  main :global(br) {
    display: block;
    margin-bottom: 0.75rem;
  }
  .custom-scrollbar::-webkit-scrollbar { width: 4px; }
  .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
  .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(13,148,136,0.5); }
  html { scroll-behavior: smooth; }
  @media (prefers-reduced-motion: reduce) {
    html { scroll-behavior: auto; }
  }
</style>
