---
const currentYear = new Date().getFullYear();
import { CONTENT } from "../constants/content";
import SectionSpotlight from "./SectionSpotlight";
---

<footer
  class="relative overflow-hidden bg-paper pt-16 md:pt-32 pb-10 border-t border-charcoal/15"
  id="footer"
  data-footer
>
  <SectionSpotlight client:visible color="rgba(91, 33, 182, 0.12)" blendMode="multiply" />

  <div
    class="absolute inset-0 opacity-40 mix-blend-multiply pointer-events-none"
    aria-hidden="true"
    role="none"
    style={`background-image: url('${CONTENT.assets.noiseTexture}'); filter: contrast(120%) brightness(100%);`}
  ></div>

  <div class="absolute -top-1/3 -left-1/4 w-[700px] h-[700px] rounded-full blur-[200px] bg-brand-violet/[0.035] pointer-events-none" aria-hidden="true"></div>
  <div class="absolute -bottom-1/3 right-0 w-[500px] h-[500px] rounded-full blur-[160px] bg-brand-teal/[0.025] pointer-events-none" aria-hidden="true"></div>

  <div class="container mx-auto px-4 sm:px-6 relative z-10">

    <div
      class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px -translate-x-1/2 bg-gradient-to-b from-charcoal/10 via-charcoal/[0.04] to-transparent"
      aria-hidden="true"
      role="none"
    ></div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-12 gap-10 md:gap-12 mb-20 sm:mb-32 relative z-10">

      {/* Brand */}
      <div class="sm:col-span-2 md:col-span-6 flex flex-col justify-between pr-0 md:pr-12">
        <div class="mb-8 sm:mb-0">
          <div class="flex items-center gap-2.5 mb-5 footer-fade" style="--d:0">
            <img
              src={CONTENT.assets.logoDark}
              alt=""
              width="40"
              height="40"
              class="w-10 h-10 md:w-18 md:h-18 opacity-90 drop-shadow-[0_1px_2px_rgba(0,0,0,0.06)]"
              loading="lazy"
              role="presentation"
            />
            <span class="font-serif text-xl sm:text-2xl text-charcoal font-medium tracking-tight">
              {CONTENT.footer.brand.name}
            </span>
          </div>
          <div class="footer-fade" style="--d:1">
            <p class="max-w-md text-charcoal/70 leading-relaxed font-serif text-base sm:text-lg italic border-l-2 border-brand-violet/15 pl-4">
              {CONTENT.footer.brand.quote}
            </p>
            <span class="block text-charcoal/60 font-sans text-sm not-italic mt-4 leading-relaxed max-w-sm">
              {CONTENT.footer.brand.description}
            </span>
          </div>
        </div>
      </div>

      {/* Directory */}
      <div class="md:col-span-3 pl-0 md:pl-8">
        <p
          id="footer-directory-heading"
          class="font-mono text-xs font-semibold text-charcoal/70 uppercase tracking-[0.2em] mb-5 sm:mb-7 footer-fade"
          style="--d:2"
          role="heading"
          aria-level="2"
        >
          {CONTENT.footer.directory.title}
        </p>
        <nav aria-labelledby="footer-directory-heading">
          <ul class="space-y-0" role="list">
            {CONTENT.footer.directory.links.map((link, i) => (
              <li class="footer-fade" style={`--d:${i + 3}`}>
                <a
                  href={link.href}
                  class="group relative flex items-center py-3 text-charcoal/70 hover:text-charcoal focus-visible:text-charcoal transition-colors duration-300 min-h-[44px] touch-manipulation rounded-sm focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-violet"
                >
                  <span
                    class="absolute left-0 top-1/2 -translate-y-1/2 w-0.5 h-0 rounded-full bg-brand-violet/50 group-hover:h-5 group-focus-visible:h-5 transition-all duration-400 ease-out"
                    aria-hidden="true"
                  ></span>
                  <span class="text-sm tracking-wide pl-3 group-hover:translate-x-1 group-focus-visible:translate-x-1 transition-transform duration-300 ease-out">
                    {link.label}
                  </span>
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </div>

      {/* Connect */}
      <div class="md:col-span-3">
        <p
          id="footer-connect-heading"
          class="font-mono text-xs font-semibold text-charcoal/70 uppercase tracking-[0.2em] mb-5 sm:mb-7 footer-fade"
          style="--d:2"
          role="heading"
          aria-level="2"
        >
          {CONTENT.footer.connect.title}
        </p>
        <nav aria-labelledby="footer-connect-heading">
          <ul class="space-y-0" role="list">
            {CONTENT.footer.connect.links.map((link, i) => {
              const isExternal = link.href.startsWith("http");
              const isMailto = link.href.startsWith("mailto:");
              return (
                <li class="footer-fade" style={`--d:${i + 3}`}>
                  <a
                    href={link.href}
                    class="group relative flex items-center py-3 text-charcoal/70 hover:text-charcoal focus-visible:text-charcoal transition-colors duration-300 min-h-[44px] touch-manipulation rounded-sm focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-violet"
                    {...(isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
                  >
                    <span
                      class="absolute left-0 top-1/2 -translate-y-1/2 w-0.5 h-0 rounded-full bg-brand-teal/50 group-hover:h-5 group-focus-visible:h-5 transition-all duration-400 ease-out"
                      aria-hidden="true"
                    ></span>
                    <span class="text-sm tracking-wide pl-3 group-hover:translate-x-1 group-focus-visible:translate-x-1 transition-transform duration-300 ease-out flex items-center gap-1.5">
                      {link.label}
                      {isMailto && <span class="sr-only">Email Support</span>}
                      {isExternal && (
                        <>
                          <span class="sr-only">(opens in new tab)</span>
                          <svg
                            class="w-3 h-3 opacity-0 group-hover:opacity-40 group-focus-visible:opacity-40 -translate-y-px group-hover:-translate-y-0.5 group-hover:translate-x-0.5 transition-all duration-300"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2.5"
                            aria-hidden="true"
                            role="none"
                          >
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25" />
                          </svg>
                        </>
                      )}
                    </span>
                  </a>
                </li>
              );
            })}
          </ul>
        </nav>
      </div>
    </div>

    {/* ━━ Bottom ━━ */}
    <div class="relative pt-12 footer-fade" style="--d:8">

      <div
        class="absolute left-0 right-0 top-0 h-px bg-gradient-to-r from-transparent via-charcoal/10 to-transparent"
        aria-hidden="true"
        role="none"
      ></div>

      <div
        class="absolute left-0 right-0 top-0 h-48 pointer-events-none opacity-[0.03] select-none overflow-hidden mix-blend-multiply"
        aria-hidden="true"
        role="none"
      >
        <svg
          width="100%"
          height="100%"
          viewBox="0 0 1440 200"
          preserveAspectRatio="none"
          class="w-full h-full min-w-[900px]"
          aria-hidden="true"
          role="none"
          focusable="false"
        >
          <defs>
            <pattern id="footer-grid" width="48" height="48" patternUnits="userSpaceOnUse">
              <path d="M 48 0 L 0 0 0 48" fill="none" stroke="currentColor" stroke-width="0.5" />
            </pattern>
          </defs>
          <rect width="100%" height="100%" fill="url(#footer-grid)" class="text-charcoal" />
          <g class="text-charcoal">
            <circle cx="120" cy="100" r="60" fill="none" stroke="currentColor" stroke-width="0.8" />
            <circle cx="120" cy="100" r="30" fill="none" stroke="currentColor" stroke-width="0.4" stroke-dasharray="3 3" />
            <line x1="60" y1="100" x2="180" y2="100" stroke="currentColor" stroke-width="0.4" />
            <line x1="120" y1="40" x2="120" y2="160" stroke="currentColor" stroke-width="0.4" />
          </g>
          <g class="text-charcoal" transform="translate(1320,100)">
            <rect x="-30" y="-30" width="60" height="60" fill="none" stroke="currentColor" stroke-width="0.8" />
            <line x1="-40" y1="0" x2="40" y2="0" stroke="currentColor" stroke-width="0.4" />
            <line x1="0" y1="-40" x2="0" y2="40" stroke="currentColor" stroke-width="0.4" />
          </g>
          <path d="M 180 100 L 280 100 L 300 60 L 1140 60 L 1160 100 L 1290 100" fill="none" stroke="currentColor" stroke-width="0.4" class="text-charcoal" />
          {[300, 480, 660, 840, 1020].map(x => (
            <circle cx={x} cy="60" r="1.5" class="fill-charcoal" />
          ))}
          <text x="720" y="170" text-anchor="middle" font-family="monospace" font-size="8" letter-spacing="0.25em" class="fill-charcoal uppercase opacity-40">
            {CONTENT.footer.system.label}
          </text>
        </svg>
      </div>

      <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-5 relative z-10">
        <div class="flex flex-col gap-1.5">
          <span class="font-mono text-[11px] text-charcoal/60">
            {CONTENT.footer.legal.copyright(currentYear)}
          </span>
        </div>

        <nav aria-label="Legal links" class="flex flex-wrap gap-x-8 gap-y-2 font-mono text-[11px] text-charcoal/55 uppercase tracking-wider">
          {CONTENT.footer.legal.links.map(link => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              class="hover:text-brand-violet focus-visible:text-brand-violet active:scale-95 transition-all duration-300 underline decoration-charcoal/10 hover:decoration-brand-violet/30 underline-offset-4 rounded-sm py-1 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-violet"
            >
              {link.label}
              <span class="sr-only">(opens in new tab)</span>
            </a>
          ))}
        </nav>
      </div>
    </div>
  </div>
</footer>

<style>
  [data-footer]:not(.is-visible) .footer-fade {
    opacity: 0;
    transform: translateY(14px);
  }

  .footer-fade {
    transition:
      opacity 0.7s cubic-bezier(0.22, 1, 0.36, 1),
      transform 0.7s cubic-bezier(0.22, 1, 0.36, 1);
    transition-delay: calc(var(--d, 0) * 0.07s);
  }

  @media (prefers-reduced-motion: reduce) {
    .footer-fade,
    [data-footer]:not(.is-visible) .footer-fade {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>

<noscript>
  <style>
    .footer-fade {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  </style>
</noscript>

<script>
  document.addEventListener('astro:page-load', () => {
    const footer = document.querySelector<HTMLElement>('[data-footer]');
    if (footer) {
      const observer = new IntersectionObserver(
        ([entry]) => {
          if (entry.isIntersecting) {
            footer.classList.add('is-visible');
            observer.disconnect();
          }
        },
        { threshold: 0.06 }
      );
      observer.observe(footer);
    }
  });
</script>